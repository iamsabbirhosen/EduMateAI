{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///F:/EduMateFinalAI/EduMateAI/src/app/api/pdf/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport fs from 'fs/promises';\r\nimport path from 'path';\r\n\r\n// Simple in-memory cache for PDF files\r\nconst pdfCache = new Map<string, { buffer: Buffer; timestamp: number }>();\r\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const filePath = searchParams.get('path');\r\n    \r\n    if (!filePath) {\r\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 });\r\n    }\r\n\r\n    // Quick validation - only allow specific patterns\r\n    if (filePath.includes('..') || \r\n        !filePath.startsWith('/materials/') || \r\n        !filePath.endsWith('/material.pdf')) {\r\n      return NextResponse.json({ error: 'Access denied' }, { status: 403 });\r\n    }\r\n\r\n    // Simplified referer check (less strict for performance)\r\n    const referer = request.headers.get('referer');\r\n    if (!referer || !referer.includes('localhost:9002')) {\r\n      return NextResponse.json({ error: 'Direct access not allowed' }, { status: 403 });\r\n    }\r\n\r\n    const fullPath = path.join(process.cwd(), 'public', filePath);\r\n    \r\n    // Check cache first\r\n    const cached = pdfCache.get(fullPath);\r\n    const now = Date.now();\r\n    \r\n    let fileBuffer: Buffer;\r\n    \r\n    if (cached && (now - cached.timestamp) < CACHE_DURATION) {\r\n      // Use cached version\r\n      fileBuffer = cached.buffer;\r\n    } else {\r\n      try {\r\n        // Async file read for better performance\r\n        fileBuffer = await fs.readFile(fullPath);\r\n        // Cache the file\r\n        pdfCache.set(fullPath, { buffer: fileBuffer, timestamp: now });\r\n      } catch (error) {\r\n        return NextResponse.json({ error: 'Content not found' }, { status: 404 });\r\n      }\r\n    }\r\n    \r\n    // Create response with optimized headers\r\n    const response = new NextResponse(fileBuffer);\r\n    \r\n    response.headers.set('Content-Type', 'application/pdf');\r\n    response.headers.set('Content-Disposition', 'inline; filename=\"protected.pdf\"');\r\n    response.headers.set('Cache-Control', 'private, max-age=300'); // 5 minutes cache\r\n    response.headers.set('X-Content-Type-Options', 'nosniff');\r\n    response.headers.set('X-Frame-Options', 'SAMEORIGIN');\r\n    \r\n    return response;\r\n  } catch (error) {\r\n    console.error('Error serving PDF:', error);\r\n    return NextResponse.json({ error: 'Server error' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEA,uCAAuC;AACvC,MAAM,WAAW,IAAI;AACrB,MAAM,iBAAiB,IAAI,KAAK,MAAM,YAAY;AAE3C,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,IAAI,CAAC,UAAU;YACb,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,kDAAkD;QAClD,IAAI,SAAS,QAAQ,CAAC,SAClB,CAAC,SAAS,UAAU,CAAC,kBACrB,CAAC,SAAS,QAAQ,CAAC,kBAAkB;YACvC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,yDAAyD;QACzD,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC;QACpC,IAAI,CAAC,WAAW,CAAC,QAAQ,QAAQ,CAAC,mBAAmB;YACnD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,MAAM,WAAW,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;QAEpD,oBAAoB;QACpB,MAAM,SAAS,SAAS,GAAG,CAAC;QAC5B,MAAM,MAAM,KAAK,GAAG;QAEpB,IAAI;QAEJ,IAAI,UAAU,AAAC,MAAM,OAAO,SAAS,GAAI,gBAAgB;YACvD,qBAAqB;YACrB,aAAa,OAAO,MAAM;QAC5B,OAAO;YACL,IAAI;gBACF,yCAAyC;gBACzC,aAAa,MAAM,qHAAA,CAAA,UAAE,CAAC,QAAQ,CAAC;gBAC/B,iBAAiB;gBACjB,SAAS,GAAG,CAAC,UAAU;oBAAE,QAAQ;oBAAY,WAAW;gBAAI;YAC9D,EAAE,OAAO,OAAO;gBACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAoB,GAAG;oBAAE,QAAQ;gBAAI;YACzE;QACF;QAEA,yCAAyC;QACzC,MAAM,WAAW,IAAI,gIAAA,CAAA,eAAY,CAAC;QAElC,SAAS,OAAO,CAAC,GAAG,CAAC,gBAAgB;QACrC,SAAS,OAAO,CAAC,GAAG,CAAC,uBAAuB;QAC5C,SAAS,OAAO,CAAC,GAAG,CAAC,iBAAiB,yBAAyB,kBAAkB;QACjF,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;QAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;QAExC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF","debugId":null}}]
}
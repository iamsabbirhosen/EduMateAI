{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\nimport jwt from 'jsonwebtoken';\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'EduMate-AI-Super-Secret-Key-2024-Change-In-Production';\r\n\r\nexport function middleware(request: NextRequest) {\r\n  const response = NextResponse.next();\r\n  const pathname = request.nextUrl.pathname;\r\n\r\n  // Fast path: Block direct PDF access\r\n  if (pathname.startsWith('/materials/') && pathname.endsWith('.pdf')) {\r\n    return new NextResponse('Access denied', { status: 403 });\r\n  }\r\n\r\n  // Admin route protection\r\n  if (pathname.startsWith('/admin') && !pathname.startsWith('/admin/login')) {\r\n    const token = request.cookies.get('admin-token')?.value;\r\n\r\n    console.log('Admin route access:', pathname, 'Token:', !!token);\r\n\r\n    if (!token) {\r\n      console.log('No token found, redirecting to login');\r\n      return NextResponse.redirect(new URL('/admin/login', request.url));\r\n    }\r\n\r\n    try {\r\n      jwt.verify(token, JWT_SECRET);\r\n      console.log('Token verified successfully');\r\n    } catch (error) {\r\n      console.log('Token verification failed:', error);\r\n      return NextResponse.redirect(new URL('/admin/login', request.url));\r\n    }\r\n  }\r\n\r\n  // Admin API route protection\r\n  if (pathname.startsWith('/api/admin')) {\r\n    const token = request.cookies.get('admin-token')?.value;\r\n\r\n    if (!token) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    try {\r\n      jwt.verify(token, JWT_SECRET);\r\n    } catch (error) {\r\n      return NextResponse.json({ error: 'Invalid token' }, { status: 401 });\r\n    }\r\n  }\r\n\r\n  // Optimized security headers for PDF API only\r\n  if (pathname.startsWith('/api/pdf')) {\r\n    response.headers.set('X-Frame-Options', 'SAMEORIGIN');\r\n    response.headers.set('X-Content-Type-Options', 'nosniff');\r\n    response.headers.set('Cache-Control', 'private, max-age=300');\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    '/api/pdf/:path*',\r\n    '/admin/:path*',\r\n    '/api/admin/:path*',\r\n    '/((?!_next/static|_next/image|favicon.ico).*)',\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AAEA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,WAAW,OAAoB;IAC7C,MAAM,WAAW,6LAAA,CAAA,eAAY,CAAC,IAAI;IAClC,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;IAEzC,qCAAqC;IACrC,IAAI,SAAS,UAAU,CAAC,kBAAkB,SAAS,QAAQ,CAAC,SAAS;QACnE,OAAO,IAAI,6LAAA,CAAA,eAAY,CAAC,iBAAiB;YAAE,QAAQ;QAAI;IACzD;IAEA,yBAAyB;IACzB,IAAI,SAAS,UAAU,CAAC,aAAa,CAAC,SAAS,UAAU,CAAC,iBAAiB;QACzE,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;QAElD,QAAQ,GAAG,CAAC,uBAAuB,UAAU,UAAU,CAAC,CAAC;QAEzD,IAAI,CAAC,OAAO;YACV,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;QAClE;QAEA,IAAI;YACF,6IAAA,CAAA,UAAG,CAAC,MAAM,CAAC,OAAO;YAClB,QAAQ,GAAG,CAAC;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,GAAG,CAAC,8BAA8B;YAC1C,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;QAClE;IACF;IAEA,6BAA6B;IAC7B,IAAI,SAAS,UAAU,CAAC,eAAe;QACrC,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;QAElD,IAAI,CAAC,OAAO;YACV,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,IAAI;YACF,6IAAA,CAAA,UAAG,CAAC,MAAM,CAAC,OAAO;QACpB,EAAE,OAAO,OAAO;YACd,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;IACF;IAEA,8CAA8C;IAC9C,IAAI,SAAS,UAAU,CAAC,aAAa;QACnC,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;QACxC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;QAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,iBAAiB;IACxC;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;QACA;QACA;QACA;KACD;AACH"}}]
}